# Cloudflare Pages Deployment Guide

## Overview

This document outlines the enhanced Cloudflare Pages deployment configuration for the GIVC Healthcare Platform, including build commands, output directories, and deployment best practices.

## Configuration

### Wrangler Configuration (`wrangler.toml`)

The project is configured with the following Cloudflare Pages settings:

```toml
name = "givc"
compatibility_date = "2023-11-01"

# Pages configuration
pages_build_command = "npm run build"
pages_build_output_dir = "dist"

# Build optimization settings
[build]
command = "npm run build"
publish = "dist"

# Node.js configuration for consistent builds
[build.environment]
NODE_VERSION = "20"
NPM_VERSION = "10"

# Environment variables for Pages
[vars]
ENVIRONMENT = "production"
HIPAA_COMPLIANCE_LEVEL = "strict"
RCM_ACCREDITATION = "enabled"
```

### Build Process

The build process follows these steps:

1. **Build Command**: `npm run build` (runs Vite build)
2. **Output Directory**: `dist/` (generated by Vite)
3. **Build Validation**: Automatic validation of build artifacts
4. **Deployment**: Upload to Cloudflare Pages

## Deployment Methods

### 1. Automatic Deployment (Recommended)

When you push to the main branch, GitHub Actions automatically:
- Runs tests and quality checks
- Builds the application
- Validates build output
- Deploys to Cloudflare Pages

### 2. Manual Deployment via npm Scripts

```bash
# Deploy to production
npm run deploy:production

# Deploy to staging
npm run deploy:staging

# Deploy with custom build
npm run build:production
npm run validate-build
wrangler pages deploy dist
```

### 3. Manual Deployment via deploy.sh Script

```bash
# Deploy to all projects
./deploy.sh all

# Deploy to specific project
./deploy.sh main
./deploy.sh static
./deploy.sh ui
./deploy.sh platform
./deploy.sh healthcare
```

### 4. Direct Wrangler Deployment

```bash
# Build first
npm run build

# Validate build
npm run validate-build

# Deploy
wrangler pages deploy dist
```

## Build Validation

The enhanced deployment process includes automatic build validation that checks:

- ✅ `dist/` directory exists
- ✅ `dist/index.html` is present and has content
- ✅ Build size is reasonable
- ✅ Essential assets are generated
- ⚠️ Optional files (PWA manifest, service worker)

### Running Build Validation Manually

```bash
npm run validate-build
```

## Environment Configuration

### Node.js Version

The project is configured to use Node.js 20 for consistent builds across all environments:

- Local development: Specified in `.nvmrc` (if present)
- GitHub Actions: Configured in workflow files
- Cloudflare Pages: Specified in `wrangler.toml`

### Environment Variables

Production environment variables are configured in `wrangler.toml`:

```toml
[vars]
ENVIRONMENT = "production"
HIPAA_COMPLIANCE_LEVEL = "strict"
RCM_ACCREDITATION = "enabled"
```

## Troubleshooting

### Common Issues

1. **Build Fails with "dist directory not found"**
   - Ensure `npm run build` completes successfully
   - Check that Vite is configured to output to `dist/`
   - Verify no build errors in the console

2. **Deployment Fails with "No files to upload"**
   - Run `npm run validate-build` to check build output
   - Ensure `dist/` directory contains files
   - Check file permissions on build artifacts

3. **Build Validation Fails**
   - Review validation output for specific issues
   - Ensure all required files are generated
   - Check build size and file count

### Debug Commands

```bash
# Check build output
ls -la dist/

# Validate build manually
npm run validate-build

# Check build size
du -sh dist/

# Test build locally
npm run preview
```

## Performance Optimization

### Build Optimizations

The Vite configuration includes several optimizations:

- **Code Splitting**: Vendor, router, UI, and utility chunks
- **Minification**: Terser minification for production
- **Tree Shaking**: Automatic removal of unused code
- **Asset Optimization**: Compressed images and optimized CSS

### Cloudflare Pages Optimizations

- **Edge Caching**: Static assets cached at Cloudflare edge
- **Compression**: Automatic Gzip/Brotli compression
- **HTTP/2**: Automatic HTTP/2 support
- **Global CDN**: Worldwide content distribution

## Monitoring and Analytics

### Build Monitoring

- GitHub Actions provide build status and logs
- Build validation reports issues automatically
- Build size tracking in deployment logs

### Deployment Monitoring

- Cloudflare Pages dashboard shows deployment status
- Real-time logs available during deployment
- Performance metrics in Cloudflare Analytics

## Security Considerations

### HIPAA Compliance

The platform is configured for HIPAA compliance:

- Environment variables set for strict compliance mode
- Secure build and deployment processes
- No sensitive data in build artifacts

### RCM Accreditation

Revenue Cycle Management accreditation is enabled:

- Proper environment configuration
- Secure data handling in build process
- Compliance monitoring enabled

## Best Practices

### Development Workflow

1. **Local Development**: Use `npm run dev` for development
2. **Testing**: Run `npm run test` before committing
3. **Building**: Use `npm run build` to test production builds
4. **Validation**: Run `npm run validate-build` to verify output
5. **Deployment**: Use appropriate deployment method for environment

### Deployment Workflow

1. **Staging First**: Always deploy to staging before production
2. **Validation**: Ensure build validation passes
3. **Testing**: Test deployed application functionality
4. **Monitoring**: Monitor deployment logs and performance
5. **Rollback**: Have rollback plan ready if issues occur

## Support

For deployment issues or questions:

1. Check this documentation first
2. Review GitHub Actions logs for CI/CD issues
3. Check Cloudflare Pages dashboard for deployment status
4. Review build validation output for specific errors
5. Contact the development team for additional support

---

**Last Updated**: $(date)
**Version**: 1.0.0
**Maintainer**: Dr. Al Fadil (BRAINSAIT LTD)